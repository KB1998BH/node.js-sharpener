

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expense App</title>
</head>
<body>
    <div class="container">
        <h1>Expense Tracker</h1>
        <form onsubmit="addNewExpenses(event)">
            <label for="expenseAmount">Choose ExpenseAmount:</label>
            <input type="number" name="expenseamount" required>
            <label for="description">Choose Description:</label>
            <input type="text" name="description" required>
            <label for="Choose Category">Choose a Category</label>
            <select id="category" name="category">
                <option value="fuel">fuel</option>
                <option value="food">food</option>
                <option value="electricity">electricity</option>
                <option value="movie">movie</option>
            </select>
            <button type="submit">Add Expense</button>
        </form>
        
    </div>
    <ul id="listOfExpenses"></ul>

    <button id="rzp-button1">Buy Premium</button>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.8/axios.min.js" integrity="sha512-PJa3oQSLWRB7wHZ7GQ/g+qyv6r4mbuhmiDb8BjSFZ8NZ2a42oTtAq5n0ucWAwcQDlikAtkub+tPVCw4np27WCg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        function addNewExpenses(e){
            e.preventDefault();

            const expenseDetails = {
                expenseamount: e.target.expenseamount.value,
                description: e.target.description.value,
                category: e.target.category.value,
                
            }
            console.log(expenseDetails);
            const token = localStorage.getItem('token');
            axios.post('http://localhost:5510/expense/addexpense', expenseDetails, { headers:{"Authorization": token}})
            .then((response) => {
                addNewExpensestoUI(response.data.expense);
            }).catch(err => showError(err));
        }

        window.addEventListener("DOMContentLoaded", () => {
            const token = localStorage.getItem('token');
            axios.get('http://localhost:5510/expense/getexpenses', { headers:{"Authorization": token}})
            .then((response) => {
                response.data.expenses.forEach(expense => {
                    addNewExpensestoUI(expense);
                })
            })
            .catch((err) => {
                console.log("bad error");
            })
        })

        function addNewExpensestoUI(expense){
            const parentElement = document.getElementById('listOfExpenses');
            const expenseElemId = `expense-${expense.id}`;
            parentElement.innerHTML += `
            <li id=${expenseElemId}>
                ${expense.expenseamount} - ${expense.category} - ${expense.description}
                <button onclick='deleteExpense(event, ${expense.id})'>
                    Delete Expense
                </button>
            </li>
            `
        }

        function deleteExpense(e, expenseid){
            const token = localStorage.getItem('token');
            axios.delete(`http://localhost:5510/expense/deleteexpense/${expenseid}`, {headers:{"Authorization":token}}).then((response) =>{
                removeExpensefromUI(expenseid);
            }).catch((err => {
                showError(err);
            }))
        }
        function removeExpensefromUI(expenseid){
            const expenseElemId = `expense-${expenseid}`;
            document.getElementById(expenseElemId).remove();
        }

        function showError(err){
            document.body.innerHTML += `<div style="color:red;"> ${err}</div>`
        }

        document.getElementById('rzp-button1').onclick = async function(e){
            console.log("apply");
            const token = localStorage.getItem('token');
            const response = await axios.get('http://localhost:5510/purchase/premiummembership', {headers: {"Authorization":token}})
            console.log(response);
            var options = 
            {
                "key": response.data.key_id, //Enter the key id generated from the dashboard
                "order_id": response.data.order.id, //For one time payment;
                //This handler function will handle the success payment
                "handler": async function(response){
                    await axios.post('http://localhost:5510/purchase/updatetransactionstatus', {
                        order_id: options.order_id,
                        payment_id: response.razorpay_payment_id,
                    }, {headers: {"Authorization" : token}})


                    alert('You are a premium user now')
                },
            };
            const rzp1 = new Razorpay(options);
            rzp1.open();
            e.preventDefault();

            rep1.on('payment failed', function (response) {
                console.log(response);
                alert('something went wrong');
            })
        }


    </script>
</body>
</html>
